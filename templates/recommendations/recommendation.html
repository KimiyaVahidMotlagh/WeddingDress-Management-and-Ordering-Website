{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/recommendation.css' %}?v=2.0">
{% endblock %}

{% block content %}
<div class="main-container">
    <div class="page-title">
        <h2>My Generated Wedding Dresses</h2>
        </div>

        <div class="recommendation-content">
        <div class="generate-button-container">
            <a href="{% url 'recommendation:generate' %}" class="generate-btn-page">Generate New Dress</a>
        </div>

        <div class="images-section">
            {% if user_images %}
            <div class="image-container">
                {% for image in user_images %}
                <div class="generated-item">
                    <img src="{{ image.image.url }}" alt="Generated image {{ forloop.counter }}" class="generated-image">
                    <div class="image-info">
                        <p class="image-prompt">{{ image.prompt|truncatewords:10 }}</p>
                        <p class="image-date">{{ image.created_at|date:"M d, Y H:i" }}</p>
                    </div>

                    <div class="image-actions">
                        <button class="save-btn" onclick="downloadImage('{{ image.image.url }}', 'generated_{{ image.id }}.png')">
                            Download
                        </button>
                        <button class="favorite-heart" data-image-id="{{ image.id }}">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.28 2 8.5C2 5.42 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.09C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.42 22 8.5C22 12.28 18.6 15.36 13.45 20.04L12 21.35Z" fill="#CFBB99"/>
                            </svg>
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="no-images-message">
                <p>You haven't generated any wedding dresses yet.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function downloadImage(imageUrl, fileName) {
    const link = document.createElement('a');
    link.href = imageUrl;
    link.download = fileName;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>
{% endblock %}